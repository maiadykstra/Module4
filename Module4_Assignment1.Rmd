---
title: "Assignment 1: Fixing Poor Data Visualization"
Author: "Maia Dykstra"
output: html_document
---

### This assignment demonstrates the use of ggplot to created effective data visualizations in R. Below is a figure with less-than-deal data visualization. ###

![](Bad graph 1.png)
This figure [Cotter et al., (2004)](http://www.ncbi.nlm.nih.gov/pubmed/15528060?dopt=Abstract) shows 1-year mortality rate among patients separated by hematocrit (%) and quartile grouping by dose of epoetin received. The three dimensional aspect of the figure makes it difficult to read, the colours are somewhat jarring, and the mortality rate could be simplified to a percentage for ease of understanding. This figure was identified as one of the [top 10 worst published graphs](https://www.biostat.wisc.edu/~kbroman/topten_worstgraphs/) by a University of Wisconsin website. 

## Fixing the Scary Graph ##

The first step is to get the data into R. I've made estimates of the values shown in the figure for the sake of this exercise. I converted survival rates to percentages rather than per thousand, adressing one of the interpretation issues with the graph. Data is read from a .csv file using a function from the tidyverse library. 

```{r}
library(tidyverse)

data <- read_csv("BadGraphData.csv")

```

Now I will generate a new figure using ggplot. A bar graph is still a good option, but a set of several successive sets of bars will be much easier to understand than the 3D plot. In the following code, ggplot generates a bar graph in which the x-axis is categorical bins for hematocrit percentage as used in the original plot. The y-axis shows mortality percentage, and the bars' fill color represents the quartile group for the dose of epoetin received. The 'position = "dodge" ' component places the x-axis results of the same bin next to each other instead of overlapping, and the 'stat = "identity"' component tells ggplot to use the entered mortality values rather than automatically calculated count values. 

```{r}
library(ggplot2)

ggplot(data = data)+
  geom_bar(mapping = aes(x = Hematocrit, y = Mortality, fill = Dose), position = "dodge", stat = "identity")

```

This new graph looks much better than the original, and fixes two of the three issues I identified (percentages for clarity, 2D instead of 3d structure), but the colours and labels can still be adjusted to improve the aesthetics and readability of this graph. The following code adds more appropriate labels to the axes and colour legend via the labs function. It also adjusts the colour theme of the fill to something less jarring than the original graph using the scale_fill_brewer function. This function changes the color scheme to a different set of values, a list of which can be found [here](http://www.cookbook-r.com/Graphs/Colors_(ggplot2)/).

```{r}
ggplot(data = data)+
  geom_bar(mapping = aes(x = Hematocrit, y = Mortality, fill = Dose), position = "dodge", stat = "identity") +
  scale_fill_brewer(palette = "Spectral") +
labs(
    x = "Hematocrit (%)",
    y = " 1-Year Mortality Rate (%)",
    fill = "Epoetin Dose Quartile"
  ) 
```

This new plot clearly shows that both Hematocrit and Epoetin dose have an impact on patient mortality, and also appear to have a combined effect, especially at low hematocrit. While this isn't the worlds most superior plot, it has significantly improved interpretability and aesthetics compared to the original. This is an example of the type of highly readable plot that can be generated using ggplot with relatively simple code. 